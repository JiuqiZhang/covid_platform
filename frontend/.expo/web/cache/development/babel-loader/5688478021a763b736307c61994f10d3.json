{
	"ast": null,
	"code": "import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\n\nvar _this = this;\n\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport Auth from \"@aws-amplify/auth\";\nimport Amplify from \"@aws-amplify/core\";\nimport Storage from \"@aws-amplify/storage\";\nimport * as Clipboard from \"expo-clipboard\";\nimport Constants from \"expo-constants\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { useEffect, useState } from \"react\";\nimport Button from \"react-native-web/dist/exports/Button\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport View from \"react-native-web/dist/exports/View\";\nimport ScrollView from \"react-native-web/dist/exports/ScrollView\";\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport baseUrl from \"../../assets/constants/BaseUrl\";\nimport BackButton from \"../../components/BackButton\";\nimport awsconfig from \"../../datacenter/aws-exports\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nAmplify.configure(awsconfig);\n\nFileModule = function FileModule(props) {\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      image = _useState2[0],\n      setImage = _useState2[1];\n\n  var _useState3 = useState(0),\n      _useState4 = _slicedToArray(_useState3, 2),\n      percentage = _useState4[0],\n      setPercentage = _useState4[1];\n\n  var a = [];\n\n  for (var n = 0; n < props.venue.image_num; n++) {\n    a[n] = 0;\n  }\n\n  useEffect(function () {\n    props.getVenuesByID(props.route.params.id);\n\n    (function _callee() {\n      var cameraRollStatus, cameraStatus;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!Constants.platform.ios) {\n                _context.next = 8;\n                break;\n              }\n\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(ImagePicker.requestMediaLibraryPermissionsAsync());\n\n            case 3:\n              cameraRollStatus = _context.sent;\n              _context.next = 6;\n              return _regeneratorRuntime.awrap(ImagePicker.requestCameraPermissionsAsync());\n\n            case 6:\n              cameraStatus = _context.sent;\n\n              if (cameraRollStatus.status !== \"granted\" || cameraStatus.status !== \"granted\") {\n                alert(\"Sorry, we need these permissions to make this work!\");\n              }\n\n            case 8:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n  useEffect(function () {\n    if (percentage === 100) {\n      props.editImages(props.venue.id, props.venue.image_num + 1);\n      props.venue.image_num = props.venue.image_num + 1;\n    }\n  }, [percentage]);\n\n  var takePhoto = function takePhoto() {\n    var result;\n    return _regeneratorRuntime.async(function takePhoto$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.launchCameraAsync({\n              mediaTypes: \"Images\",\n              aspect: [4, 3]\n            }));\n\n          case 2:\n            result = _context2.sent;\n\n            _this.handleImagePicked(result);\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var pickImage = function pickImage() {\n    var result;\n    return _regeneratorRuntime.async(function pickImage$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return _regeneratorRuntime.awrap(ImagePicker.launchImageLibraryAsync({\n              mediaTypes: \"Images\",\n              aspect: [4, 3],\n              quality: 1\n            }));\n\n          case 2:\n            result = _context3.sent;\n\n            _this.handleImagePicked(result);\n\n          case 4:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  handleImagePicked = function handleImagePicked(pickerResult) {\n    var img, uploadUrl;\n    return _regeneratorRuntime.async(function handleImagePicked$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.prev = 0;\n\n            if (!pickerResult.cancelled) {\n              _context4.next = 6;\n              break;\n            }\n\n            alert(\"Upload cancelled\");\n            return _context4.abrupt(\"return\");\n\n          case 6:\n            setPercentage(0);\n            props.getVenuesByID(props.route.params.id);\n            _context4.next = 10;\n            return _regeneratorRuntime.awrap(fetchImageFromUri(pickerResult.uri));\n\n          case 10:\n            img = _context4.sent;\n            _context4.next = 13;\n            return _regeneratorRuntime.awrap(uploadImage('venue/' + props.venue.id + '/' + (props.venue.image_num + 1) + \".jpg\", img));\n\n          case 13:\n            uploadUrl = _context4.sent;\n            console.log(uploadUrl);\n            downloadImage(uploadUrl);\n\n          case 16:\n            _context4.next = 22;\n            break;\n\n          case 18:\n            _context4.prev = 18;\n            _context4.t0 = _context4[\"catch\"](0);\n            console.log(_context4.t0);\n            alert(\"Upload failed\");\n\n          case 22:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, [[0, 18]], Promise);\n  };\n\n  uploadImage = function uploadImage(filename, img) {\n    Auth.currentCredentials();\n    return Storage.put(filename, img, {\n      level: \"public\",\n      contentType: \"image/jpeg\",\n      progressCallback: function progressCallback(progress) {\n        setLoading(progress);\n      }\n    }).then(function (response) {\n      return response.key;\n    }).catch(function (error) {\n      console.log(error);\n      return error.response;\n    });\n  };\n\n  var setLoading = function setLoading(progress) {\n    var calculated = parseInt(progress.loaded / progress.total * 100);\n    updatePercentage(calculated);\n  };\n\n  var updatePercentage = function updatePercentage(number) {\n    setPercentage(number);\n  };\n\n  downloadImage = function downloadImage(uri) {\n    Storage.get(uri).then(function (result) {\n      setImage(result);\n    }).catch(function (err) {\n      return console.log(err);\n    });\n  };\n\n  var fetchImageFromUri = function fetchImageFromUri(uri) {\n    var response, blob;\n    return _regeneratorRuntime.async(function fetchImageFromUri$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            _context5.next = 2;\n            return _regeneratorRuntime.awrap(fetch(uri));\n\n          case 2:\n            response = _context5.sent;\n            _context5.next = 5;\n            return _regeneratorRuntime.awrap(response.blob());\n\n          case 5:\n            blob = _context5.sent;\n            return _context5.abrupt(\"return\", blob);\n\n          case 7:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var copyToClipboard = function copyToClipboard() {\n    Clipboard.setString(image);\n    alert(\"Copied image URL to clipboard\");\n  };\n\n  return _jsxs(View, {\n    style: styles.container,\n    children: [_jsx(View, {\n      style: {\n        zIndex: 2,\n        top: 0\n      },\n      children: _jsx(BackButton, {\n        navigation: function navigation() {\n          props.navigation.goBack();\n        }\n      })\n    }), percentage !== 0 && _jsxs(Text, {\n      style: styles.percentage,\n      children: [percentage, \"%\"]\n    }), image && _jsxs(View, {\n      children: [_jsx(Text, {\n        style: styles.result,\n        onPress: copyToClipboard,\n        children: _jsx(Image, {\n          source: {\n            uri: image\n          },\n          style: {\n            width: 250,\n            height: 250\n          }\n        })\n      }), _jsx(Text, {\n        style: styles.info,\n        children: \"Long press to copy the image url\"\n      })]\n    }), _jsx(Button, {\n      onPress: pickImage,\n      title: \"Pick an image from camera roll\"\n    }), _jsx(Button, {\n      onPress: takePhoto,\n      title: \"Take a photo \"\n    }), _jsx(Button, {\n      onPress: function onPress() {\n        props.getVenuesByID(props.route.params.id);\n      },\n      title: \"Refresh\" + props.venue.image_num + props.venues[props.venues.length - 1].image_num\n    }), _jsx(ScrollView, {\n      horizontal: true,\n      scrollEventThrottle: 16,\n      style: {\n        zIndex: 3,\n        marginHorizontal: 20,\n        marginTop: 50,\n        marginBottom: 10\n      },\n      children: a.map(function (marker, index) {\n        return _jsxs(View, {\n          style: {\n            width: 100,\n            height: 100,\n            borderRadius: 10,\n            overflow: \"hidden\",\n            marginRight: 15\n          },\n          children: [_jsx(Image, {\n            source: {\n              uri: 'https://expouploads22309-dev.s3.us-east-2.amazonaws.com/public/venue/' + props.venue.id + '/' + (index + 1) + '.jpg'\n            },\n            style: {\n              height: 100,\n              width: 100\n            },\n            resizeMode: \"cover\"\n          }), _jsx(Text, {\n            children: props.venue.id + '/' + (index + 1) + '.jpg'\n          })]\n        }, index);\n      })\n    })]\n  });\n};\n\nvar getSetVenue = function getSetVenue(data) {\n  return {\n    type: 'CREATE_IMAGE',\n    venue: data.data\n  };\n};\n\nvar getVenueByID = function getVenueByID(id) {\n  return function _callee2(dispatch) {\n    var res, action;\n    return _regeneratorRuntime.async(function _callee2$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.next = 2;\n            return _regeneratorRuntime.awrap(axios.get(baseUrl + \"/venue/get/\" + id));\n\n          case 2:\n            res = _context6.sent;\n\n            if (res) {\n              action = getSetVenue(res);\n              dispatch(action);\n            }\n\n          case 4:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar editImage = function editImage(id, num) {\n  return function _callee3(dispatch) {\n    var res;\n    return _regeneratorRuntime.async(function _callee3$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.next = 2;\n            return _regeneratorRuntime.awrap(axios.put(baseUrl + \"/venue/upload/\" + id, {\n              image_num: num\n            }));\n\n          case 2:\n            res = _context7.sent;\n\n          case 3:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n};\n\nvar mapState = function mapState(state) {\n  return {\n    venues: state.report.venues,\n    venue: state.report.venue\n  };\n};\n\nvar mapDispatch = function mapDispatch(dispatch) {\n  return {\n    getVenuesByID: function getVenuesByID(id) {\n      dispatch(getVenueByID(id));\n    },\n    editImages: function editImages(id, res) {\n      dispatch(editImage(id, res));\n    }\n  };\n};\n\nexport default connect(mapState, mapDispatch)(FileModule);\nvar styles = StyleSheet.create({\n  container: {\n    marginTop: 100,\n    justifyContent: \"center\",\n    alignItems: \"center\",\n    backgroundColor: \"#F5FCFF\"\n  },\n  title: {\n    fontSize: 20,\n    marginBottom: 20,\n    textAlign: \"center\",\n    marginHorizontal: 15\n  },\n  percentage: {\n    marginBottom: 10\n  },\n  result: {\n    paddingTop: 5\n  },\n  info: {\n    textAlign: \"center\",\n    marginBottom: 20\n  }\n});",
	"map": {
		"version": 3,
		"sources": [
			"/Users/llh/Documents/map/frontend/screens/report-staff-trial/Upload.js"
		],
		"names": [
			"Auth",
			"Amplify",
			"Storage",
			"Clipboard",
			"Constants",
			"ImagePicker",
			"useEffect",
			"useState",
			"connect",
			"axios",
			"baseUrl",
			"BackButton",
			"awsconfig",
			"configure",
			"FileModule",
			"props",
			"image",
			"setImage",
			"percentage",
			"setPercentage",
			"a",
			"n",
			"venue",
			"image_num",
			"getVenuesByID",
			"route",
			"params",
			"id",
			"platform",
			"ios",
			"requestMediaLibraryPermissionsAsync",
			"cameraRollStatus",
			"requestCameraPermissionsAsync",
			"cameraStatus",
			"status",
			"alert",
			"editImages",
			"takePhoto",
			"launchCameraAsync",
			"mediaTypes",
			"aspect",
			"result",
			"handleImagePicked",
			"pickImage",
			"launchImageLibraryAsync",
			"quality",
			"pickerResult",
			"cancelled",
			"fetchImageFromUri",
			"uri",
			"img",
			"uploadImage",
			"uploadUrl",
			"console",
			"log",
			"downloadImage",
			"filename",
			"currentCredentials",
			"put",
			"level",
			"contentType",
			"progressCallback",
			"progress",
			"setLoading",
			"then",
			"response",
			"key",
			"catch",
			"error",
			"calculated",
			"parseInt",
			"loaded",
			"total",
			"updatePercentage",
			"number",
			"get",
			"err",
			"fetch",
			"blob",
			"copyToClipboard",
			"setString",
			"styles",
			"container",
			"zIndex",
			"top",
			"navigation",
			"goBack",
			"width",
			"height",
			"info",
			"venues",
			"length",
			"marginHorizontal",
			"marginTop",
			"marginBottom",
			"map",
			"marker",
			"index",
			"borderRadius",
			"overflow",
			"marginRight",
			"getSetVenue",
			"data",
			"type",
			"getVenueByID",
			"dispatch",
			"res",
			"action",
			"editImage",
			"num",
			"mapState",
			"state",
			"report",
			"mapDispatch",
			"StyleSheet",
			"create",
			"justifyContent",
			"alignItems",
			"backgroundColor",
			"title",
			"fontSize",
			"textAlign",
			"paddingTop"
		],
		"mappings": "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",
		"sourcesContent": [
			"import Auth from \"@aws-amplify/auth\";\nimport Amplify from \"@aws-amplify/core\";\nimport Storage from \"@aws-amplify/storage\";\nimport * as Clipboard from \"expo-clipboard\";\nimport Constants from \"expo-constants\";\nimport * as ImagePicker from \"expo-image-picker\";\nimport { useEffect, useState } from \"react\";\nimport { Button, Image, StyleSheet, Text, View, ScrollView } from \"react-native\";\n\nimport { connect } from 'react-redux';\nimport axios from 'axios';\nimport baseUrl from '../../assets/constants/BaseUrl'\n\nimport BackButton from \"../../components/BackButton\";\n\nimport awsconfig from \"../../datacenter/aws-exports\";\n\nAmplify.configure(awsconfig);\n\nFileModule = (props) => {\n\tconst [image, setImage] = useState(null);\n\tconst [percentage, setPercentage] = useState(0);\n\n\tvar a = [];\n\tfor (var n = 0; n < props.venue.image_num; n++) a[n] = 0\n\n\tuseEffect(() => {\n\t\tprops.getVenuesByID(props.route.params.id);\n\t\t(async () => {\n\t\t\tif (Constants.platform.ios) {\n\t\t\t\tconst cameraRollStatus =\n\t\t\t\t\tawait ImagePicker.requestMediaLibraryPermissionsAsync();\n\t\t\t\tconst cameraStatus = await ImagePicker.requestCameraPermissionsAsync();\n\t\t\t\tif (\n\t\t\t\t\tcameraRollStatus.status !== \"granted\" ||\n\t\t\t\t\tcameraStatus.status !== \"granted\"\n\t\t\t\t) {\n\t\t\t\t\talert(\"Sorry, we need these permissions to make this work!\");\n\t\t\t\t}\n\t\t\t}\n\t\t})();\n\t}, []);\n\n\tuseEffect(() => {\n\t\t// props.getVenuesByID(props.route.params.id);\n\t\tif (percentage === 100) {\n\t\t\t// props.editImages(props.route.params.id, props.venues[props.venues.length - 1].image_num + 1)\n\t\t\tprops.editImages(props.venue.id, props.venue.image_num + 1)\n\t\t\tprops.venue.image_num = props.venue.image_num + 1\n\t\t}\n\t}, [percentage]);\n\n\tconst takePhoto = async () => {\n\t\tlet result = await ImagePicker.launchCameraAsync({\n\t\t\tmediaTypes: \"Images\",\n\t\t\taspect: [4, 3],\n\t\t});\n\n\t\tthis.handleImagePicked(result);\n\t};\n\n\tconst pickImage = async () => {\n\t\tlet result = await ImagePicker.launchImageLibraryAsync({\n\t\t\tmediaTypes: \"Images\",\n\t\t\taspect: [4, 3],\n\t\t\tquality: 1,\n\t\t});\n\n\t\tthis.handleImagePicked(result);\n\t};\n\n\thandleImagePicked = async (pickerResult) => {\n\t\ttry {\n\t\t\tif (pickerResult.cancelled) {\n\t\t\t\talert(\"Upload cancelled\");\n\t\t\t\treturn;\n\t\t\t} else {\n\t\t\t\tsetPercentage(0);\n\t\t\t\tprops.getVenuesByID(props.route.params.id);\n\t\t\t\tconst img = await fetchImageFromUri(pickerResult.uri);\n\t\t\t\tconst uploadUrl = await uploadImage(\n\t\t\t\t\t// 'venue/' + props.venues[props.venues.length - 1].id + '/' + (props.venues[props.venues.length - 1].image_num + 1)\n\t\t\t\t\t'venue/' + props.venue.id + '/' + (props.venue.image_num + 1)\n\t\t\t\t\t+ \".jpg\", img);\n\t\t\t\tconsole.log(uploadUrl)\n\t\t\t\tdownloadImage(uploadUrl);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t\talert(\"Upload failed\");\n\t\t}\n\t};\n\n\tuploadImage = (filename, img) => {\n\t\tAuth.currentCredentials();\n\n\t\treturn Storage.put(filename, img, {\n\t\t\tlevel: \"public\",\n\t\t\tcontentType: \"image/jpeg\",\n\t\t\tprogressCallback(progress) {\n\t\t\t\tsetLoading(progress);\n\t\t\t},\n\t\t})\n\t\t\t.then((response) => {\n\t\t\t\treturn response.key;\n\t\t\t})\n\t\t\t.catch((error) => {\n\t\t\t\tconsole.log(error);\n\t\t\t\treturn error.response;\n\t\t\t});\n\t};\n\n\tconst setLoading = (progress) => {\n\t\tconst calculated = parseInt((progress.loaded / progress.total) * 100);\n\t\tupdatePercentage(calculated); // due to s3 put function scoped\n\t};\n\n\tconst updatePercentage = (number) => {\n\t\tsetPercentage(number);\n\t};\n\n\tdownloadImage = (uri) => {\n\t\tStorage.get(uri)\n\t\t\t.then((result) => { setImage(result) })\n\t\t\t.catch((err) => console.log(err));\n\t};\n\n\tconst fetchImageFromUri = async (uri) => {\n\t\tconst response = await fetch(uri);\n\t\tconst blob = await response.blob();\n\t\treturn blob;\n\t};\n\n\tconst copyToClipboard = () => {\n\t\tClipboard.setString(image);\n\t\talert(\"Copied image URL to clipboard\");\n\t};\n\n\treturn (\n\t\t<View style={styles.container}>\n\t\t\t<View style={{ zIndex: 2, top: 0 }}>\n\t\t\t\t<BackButton navigation={() => { props.navigation.goBack() }} />\n\t\t\t</View>\n\n\t\t\t{percentage !== 0 && <Text style={styles.percentage}>{percentage}%</Text>}\n\t\t\t{image && (\n\t\t\t\t<View>\n\n\t\t\t\t\t<Text style={styles.result} onPress={copyToClipboard}>\n\t\t\t\t\t\t<Image\n\t\t\t\t\t\t\tsource={{ uri: image }}\n\t\t\t\t\t\t\tstyle={{ width: 250, height: 250 }}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Text>\n\t\t\t\t\t<Text style={styles.info}>Long press to copy the image url</Text>\n\t\t\t\t</View>\n\t\t\t)}\n\n\t\t\t<Button onPress={pickImage} title=\"Pick an image from camera roll\" />\n\t\t\t<Button onPress={takePhoto} title={\"Take a photo \"} />\n\t\t\t<Button onPress={() => { props.getVenuesByID(props.route.params.id); }} title={\"Refresh\" + props.venue.image_num + props.venues[props.venues.length - 1].image_num} />\n\t\t\t<ScrollView\n          horizontal\n          scrollEventThrottle={16}\n          style={{ zIndex: 3, marginHorizontal: 20, marginTop:50, marginBottom:10 }}\n        >\n          {a.map((marker, index) => {\n            return (\n              <View key={index} style={{width: 100, height: 100, borderRadius: 10, overflow: \"hidden\", marginRight:15}}>\n              <Image\n                source={{uri :'https://expouploads22309-dev.s3.us-east-2.amazonaws.com/public/venue/' + props.venue.id + '/' + (index + 1) + '.jpg'}}\n                style={{height: 100, width:100}}\n                resizeMode=\"cover\"\n              />\n\t\t\t\t\t\t\t<Text>{props.venue.id + '/' + (index + 1) + '.jpg'}</Text>\n              </View>\n            );\n          })}\n        </ScrollView>\n\t\t</View>\n\t);\n}\n\nconst getSetVenue = (data) => {\n\treturn {\n\t\ttype: 'CREATE_IMAGE',\n\t\tvenue: data.data\n\t}\n};\n\nconst getVenueByID = (id) => async dispatch => {\n\tconst res = await axios.get(`${baseUrl}/venue/get/${id}`)\n\tif (res) {\n\t\tconst action = getSetVenue(res)\n\t\tdispatch(action)\n\t}\n};\n\nconst editImage = (id, num) => async dispatch => {\n\tconst res = await axios.put(`${baseUrl}/venue/upload/${id}`, { image_num: num })\n};\n\nconst mapState = (state) => {\n\treturn {\n\t\tvenues: state.report.venues,\n\t\tvenue: state.report.venue\n\t}\n}\n\nconst mapDispatch = (dispatch) => {\n\treturn {\n\t\tgetVenuesByID(id) {\n\t\t\tdispatch(getVenueByID(id))\n\t\t},\n\t\teditImages(id, res) {\n\t\t\tdispatch(editImage(id, res))\n\t\t},\n\t}\n}\n\nexport default connect(mapState, mapDispatch)(FileModule)\n\n\nconst styles = StyleSheet.create({\n\tcontainer: {\n\t\tmarginTop: 100,\n\t\tjustifyContent: \"center\",\n\t\talignItems: \"center\",\n\t\tbackgroundColor: \"#F5FCFF\",\n\t},\n\ttitle: {\n\t\tfontSize: 20,\n\t\tmarginBottom: 20,\n\t\ttextAlign: \"center\",\n\t\tmarginHorizontal: 15,\n\t},\n\tpercentage: {\n\t\tmarginBottom: 10,\n\t},\n\tresult: {\n\t\tpaddingTop: 5,\n\t},\n\tinfo: {\n\t\ttextAlign: \"center\",\n\t\tmarginBottom: 20,\n\t},\n});\n"
		]
	},
	"metadata": {},
	"sourceType": "module"
}
